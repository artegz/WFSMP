Система команд вторичного прибора  ПСВ-1М
( Команды верхнего уровня )

 специальные коды (special codes):		'/r' - 0Dh	'/n' - 0Ah

"#S/r/n"  -	получить номер прибора (get SN – serial number)
		ответ: "*Synnn/r/n" или "?/r/n" (если формат команды некорректный)
						y – последняя цифра года выпуска прибора
						nnn – порядковый номер прибора (001-999)
						ASCII десятичные

"#v/r/n"  -	получить результат измерения скорости потока (get velosity)
		ответ: "*vdddd/r/n" или "?/r/n" (если формат команды некорректный)
			dddd – десятичный код скорости (0000-9999), что соответствует
			значениям скорости потока от 0.000 до 9.999 м/с

"#f/r/n"  -	получить результат измерения частоты импульсов вертушки (get frequency)
		ответ: "*fdddd/r/n" или "?/r/n" (если формат команды некорректный)
			dddd – десятичный код частоты (0000-9999), что соответствует
			значениям частоты от 0.00 до 99.99 Герц

"#n/r/n"  -	получить результат измерения числа оборотов вертушки (get turn number)
		ответ: "*ndddd/r/n" или "?/r/n" (если формат команды некорректный)
			dddd – десятичный код числа оборотов (0000-9999)

"#t/r/n"  -	получить результат измерения  длительности интервала времени (get time)
		ответ: "*tdddd/r/n" или "?/r/n" (если формат команды некорректный)
			dddd – десятичный код (0000-9999), соответствующий длительности
			интервалов времени от 0.0 до 9.999 секунд
"#s/r/n"  -	получить байт статуса прибора (get status)
		ответ: "*vhh/r/n" или "?/r/n" (если формат команды некорректный)
			hh – шестнадцатиричный код статуса (00-FF)

"#T/r/n"  -	получить данные часов (get clock)
		ответ: "*Thhmmss/r/n" или "?/r/n" (если формат команды некорректный)
								hh – часы (hours)
					mm – минуты (minutes)
					ss – секунды (seconds)
								ASCII десятичные

"#D/r/n"  -	получить дату (get calendar)
ответ: "*DddMMyy/r/n" или "? /r/n" (если формат команды некорректный)
								dd – день (day) (1-31)
						MM – месяц (month) (1-12)
						yy – год (year) (0-99)
						ASCII десятичные

"#N/r/n"  -	получить число записей базы данных (get records number)
		ответ: "*Ndd/r/n" или "?/r/n" (если формат команды некорректный)
			dd - десятичный код числа записей (00-99)

"#wllldd/r/n"  -	записать в базу данных текущий результат измерения (write record)
		ответ: "* wllldd /r/n" или "?/r/n" (если формат команды некорректный)
			lll - десятичный код дистанции (000-999) м,
			dd - десятичный код глубины (00-99) м

"#c/r/n"  -	очистить (стереть) базу данных (clear records)
		ответ: "*c/r/n" или "?/r/n" (если формат команды некорректный)

"#B/r/n"  -	получить базу данных (get data base)
		ответ: "*B[N*37 байтов]/r/n" или "?/r/n" (если формат команды некорректный)
			N - число записей в базе данных (1-99)
			37 байтов – размер одной записи (36 десятичных или 16-ричных символов 				плюс разделитель – символ пробела (0x20)

"#b/r/n"  -	старт/стоп процесса измерения (measure start/stop )
		ответ: "*bS/r/n" или "?/r/n" (если формат команды некорректный)
			S - состояние прибора (0/1)
			0 – преобразование не закончено
			1 – преобразование закончено

"#V/r/n" – получить номер версии ПО (versie number)
		ответ: "*Vdd/r/n" или "?/r/n" (если формат команды некорректный)
			dd – десятичный код (00-99) версии ПО

"#H/r/n" – получить информационную строку (read head)
		ответ: "*H[information string]/r/n" или "?/r/n" (если формат команды некорректный)
			information string – информационная строка (символы ASCII)

"#zS/r/n"  -	включить/выключить звуковую индикацию вращения вертушки  (sound ON/OFF)
		ответ: "*zS/r/n" или "?/r/n" (если формат команды некорректный)
			S - (0/1)
			0 – выключить звук
			1 – включить звук

"#kS/r/n"  -	включить/выключить режим контроля донного контакта  (contact ON/OFF)
		ответ: "*zS/r/n" или "?/r/n" (если формат команды некорректный)
			S - (0/1)
			0 –выключить режим контроля донного контакта
			1 – включить режим контроля донного контакта

"#e/r/n"  -	выключить прибор  (device OFF)
		ответ: при успешном  выполнении отсутствует или "?/r/n" (если формат команды некорректный)

"#Raa/r/n" - прочитать байт внутренней EEPROM (read the internal EEPROM content)
ответ: "*Raadd/r/n "
	aa – HEX-код адреса байта (00-FF)
	dd - HEX-код значения байта  (00-FF)

"#Paadd/r/n"	-записать байт во внутреннюю EEPROM (write into the internal EEPROM)
	aa – адрес (address) (00 - FF)
	dd – данные (data) (00 - FF)
	NB!! ASCII HEX
ответ: "*Paadd/r/n" или "?/r/n" (если данные некорректны)

"#md/r/n"  -	задать тип вертушки (set mode)
		ответ: "*md/r/n" или "?/r/n" (если формат команды некорректный)
			d - условный номер вертушки (0-3)
			0 - вертушка 1:20
			1 - вертушка 1:1
			2  - вертушка d=70мм
			3  - вертушка d=120мм

"#dm/r/n"  -	установить режим отображения результата измерения на дисплее (set display)
		ответ: "*dm/r/n" или "?/r/n" (если формат команды некорректный)
			m - условный номер режима (0-3)
			0 - индикация времени измерения
			1 - индикация числа оборотов
			2  - индикация частоты вращения вертушки
			3  - индикация скорости потока

"#U/r/n" – получить результат измерения напряжения батареи (read Ubat)
		ответ: "*Udddd/r/n" или "?/r/n" (если формат команды некорректный)
			dddd – десятичный код (0000-9999) значения напряжения в милливольтах

"#DddMMyy/r/n"  -	установить календарь (set calendar)
								dd – день (day) (1-31)
						MM – месяц (month) (1-12)
						yy – год (year) (0-99)
						ASCII десятичные
ответ: "*DddMMyy/r/n" или ?/r/n" (если формат команды некорректный)

"#Thhmmss/r/n"  -	установить часы (set clock)		hh – часы (hours)
					mm – минуты (minutes)
					ss – секунды (seconds)
					NB!! ASCII десятичные
ответ: "*Thhmmss/r/n" или ?/r/n" (если формат команды некорректный)








Дополнительная информация:

Формат данных во внутренней EEPROM (internal EEPROM content):

адрес (address)	-	значение (value)
00 – 17 H	0-23	Таблица координат 6 точек (5 участков) кусочно-линейной аппроксимации для вертушки 70 мм
18 – 2F H	24-47	Таблица координат 6 точек (5 участков) кусочно-линейной аппроксимации для вертушки 120 мм
30 H	48	Код задержки (N=6) для подавления дребезга вертушек 1:1
31 H	49	Код задержки (N=200) для подавления дребезга вертушек 1:20
32-33 H	50-51	Поправочный коэффициент для коррекции погрешности кварца (не исп.)
34-35 H	52-53	заводской номер вертушки 70мм
36-37 H	54-55	заводской номер вертушки 120мм
38-39 H	56-57	заводской номер (serial number) вторичного прибора
3A H	58	Код статуса прибора
3B H	59	Число записей базы данных (0-99) десятичный код
3C-4С H	60-76	информационная строка (an information string)
4D-50 H	77-80	зарезервировано (reserved)
51-58 H	81-88	информационная строка (an information string) – номер версии ПО
59- FF H	89-255	зарезервировано (reserved)


Формат байта статуса прибора ("#s/r/n")
Бит 7 -  управление режимом контроля донного контакта (sens_enable)
	0: контроль выключен
	1: контроль включен
Бит 6 -  управление звуковой индикацией вращения вертушки (bipTurn_enable)
	0: звук выключен
	1: звук включен
Бит 5 -  индикатор процесса измерения (start_en)
	0: прибор ожидает команды «начать измерение»
	1: процесс измерения не закончен
Бит 4 -  индикатор окончания измерения и наличия в памяти прибора «свежих» результатов для 	   записи в базу данных (newData4record)
	0: у прибора нет новых данных для записи в базу
	1: в приборе имеются новые данные
Биты 3,2 отображают режим индикации результатов измерения (disp1,disp0)
	00:  индикация времени измерения
	01:  индикация числа оборотов
	10:  индикация частоты вращения вертушки
	11:  индикация скорости потока
Биты 1,0 отображают тип вертушки (mode1,mode0)
	00:  вертушка 1:20
	01:  вертушка 1:1
	10:  вертушка d=70мм
	11:  вертушка d=120мм


Формат вывода записи результата измерения из базы данных (37 символов ASCII)

1-2	hh	статус прибора (2 hex символа)
3-6	dddd	дистанция	(4 десятичных цифры 0000-0999)
7-8	dd	глубина (2 десятичных цифры 00-99)
9-12	dddd	скорость потока (4 десятичных цифры 0000-9999)
13-16	dddd	частота (4 десятичных цифры 0000-9999)
17-20	dddd	число оборотов (4 десятичных цифры 0000-9999)
21-24	dddd	длительность преобразования (4 десятичных цифры 0000-9999)
25-26	yy	год (2 десятичных цифры 00-99)
27-28	mm	месяц (2 десятичных цифры 01-12)
29-30	dd	день месяца (2 десятичных цифры 01-31)
31-32	hh	час (2 десятичных цифры 00-23)
33-34	MM	минуты (2 десятичных цифры 00-59)
35-36	ss	секунды (2 десятичных цифры 00-59)
37	0x20	разделитель - символ пробела
